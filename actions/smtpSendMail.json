{
  "id": "{E4539B92-E64E-29B2-F942-19C805927033}",
  "caption": "Send mail",
  "form": [
    "return [",
    "    [",
    "        'type' => 'ValidationTextBox',",
    "        'name' => 'SUBJECT',",
    "        'caption' => 'Subject'",
    "    ],",
    "    [",
    "        'type' => 'ValidationTextBox',",
    "        'name' => 'TEXT',",
    "        'caption' => 'Text'",
    "    ],",
    "    [",
    "        'type' => 'CheckBox',",
    "        'name' => 'RECEIVER_FROM_INSTANCE',",
    "        'caption' => 'Use Receiver from Instance Configuration',",
    "        'value' => true,",
    "        'onChange' => 'IPS_UpdateFormField(\"RECEIVER\", \"visible\", !$RECEIVER_FROM_INSTANCE, $id);'",
    "    ],",
    "    [",
    "        'type' => 'ValidationTextBox',",
    "        'name' => 'RECEIVER',",
    "        'caption' => 'Receiver',",
    "        'visible' => isset($_IPS['RECEIVER_FROM_INSTANCE']) ? !$_IPS['RECEIVER_FROM_INSTANCE'] : false",
    "    ],",
    "    [",
    "        'type' => 'Select',",
    "        'name' => 'ATTACHMENT_TYPE',",
    "        'caption' => 'Attachment type',",
    "        'options' => [",
    "          [ 'caption' => 'Without attachment', 'value' => 0 ],",
    "          [ 'caption' => 'With file attachment', 'value' => 1 ],",
    "          [ 'caption' => 'With media object attachment (image/sound)', 'value' => 2 ]",
    "        ],",
    "        'onChange' => ['IPS_UpdateFormField(\"ATTACHMENT_FILE\", \"visible\", $ATTACHMENT_TYPE===1, $id);',",
    "                      'IPS_UpdateFormField(\"ATTACHMENT_MEDIA\", \"visible\", $ATTACHMENT_TYPE===2, $id);'",
    "        ]",
    "    ],",
    "    [",
    "        'type' => 'ValidationTextBox',",
    "        'name' => 'ATTACHMENT_FILE',",
    "        'caption' => 'File path',",
    "        'visible' => isset($_IPS['ATTACHMENT_TYPE']) ? $_IPS['ATTACHMENT_TYPE']===1 : false",
    "    ],",
    "    [",
    "        'type' => 'SelectMedia',",
    "        'name' => 'ATTACHMENT_MEDIA',",
    "        'caption' => 'Media object',",
    "        'visible' => isset($_IPS['ATTACHMENT_TYPE']) ? $_IPS['ATTACHMENT_TYPE']===2 : false",
    "    ]",
    "];"
  ],
  "action": [
    "switch($_IPS['ATTACHMENT_TYPE']) {",
    "    case 0: ",
    "      if($_IPS['RECEIVER_FROM_INSTANCE']) {",
    "        SMTP_SendMail($_IPS['TARGET'], $_IPS['SUBJECT'], $_IPS['TEXT']);",
    "      } else {",
    "        SMTP_SendMailEx($_IPS['TARGET'], $_IPS['RECEIVER'], $_IPS['SUBJECT'], $_IPS['TEXT']);",
    "      }",
    "      break;",
    "    case 1: ",
    "      if($_IPS['RECEIVER_FROM_INSTANCE']) {",
    "        SMTP_SendMailAttachment($_IPS['TARGET'], $_IPS['SUBJECT'], $_IPS['TEXT'], $_IPS['ATTACHMENT_FILE']);",
    "      } else {",
    "        SMTP_SendMailAttachmentEx($_IPS['TARGET'], $_IPS['RECEIVER'], $_IPS['SUBJECT'], $_IPS['TEXT'], $_IPS['ATTACHMENT_FILE']);",
    "      }",
    "      break;",
    "    case 2: ",
    "      if($_IPS['RECEIVER_FROM_INSTANCE']) {",
    "        SMTP_SendMailMedia($_IPS['TARGET'], $_IPS['SUBJECT'], $_IPS['TEXT'], $_IPS['ATTACHMENT_MEDIA']);",
    "      } else {",
    "        SMTP_SendMailMediaEx($_IPS['TARGET'], $_IPS['RECEIVER'], $_IPS['SUBJECT'], $_IPS['TEXT'], $_IPS['ATTACHMENT_MEDIA']);",
    "      }",
    "      break;",
    "}"
  ],
  "restrictions": {
    "objectType": [ 1 ],
    "moduleID": [ "{375EAF21-35EF-4BC4-83B3-C780FD8BD88A}" ],
    "includeEnvironments": ["TestCommands", "Default"]
  },
  "locale": {
    "de": {
      "Subject": "Betreff",
      "Receiver": "Empfänger",
      "Attachment type": "Typ des Anhangs",
      "Use Receiver from Instance Configuration": "Benutze Empfänger aus der Instanzkonfiguration",
      "Send mail": "Sende Mail",
      "Media object": "Medienobjekt",
      "File path": "Dateipfad",
      "Without attachment": "Ohne Anhang",
      "With file attachment": "Mit Datei als Anhang",
      "With media object attachment (image/sound)": "Mit Medienobjekt als Anhang (Bild/Ton)",
      "Send mail with subject \"{SUBJECT}\"": "Versende Mail mit dem Betreff \"{SUBJECT}\"",
      "Send mail with subject \"{SUBJECT}\" {RECEIVER_FROM_INSTANCE, select, false {to Receiver {RECEIVER}} other {}} {ATTACHMENT_TYPE, select, 0 {} 1 {(Attachment: File from {ATTACHMENT_FILE}} 2 {(Attachment: Mediaobject {ATTACHMENT_MEDIA, object})}}": "Sende Mail mit dem Betreff \"{SUBJECT}\" {RECEIVER_FROM_INSTANCE, select, false {zum Empfänger {RECEIVER}} other {}} {ATTACHMENT_TYPE, select, 0 {} 1 {(Anhang: Datei von {ATTACHMENT_FILE}} 2 {(Anhang: Medienobjekt {ATTACHMENT_MEDIA, object})}}"
    },
    "Send Mail on the target address": "Sende Mail auf die Zieladresse"
  },
  "format": "Send mail with subject \"{SUBJECT}\" {RECEIVER_FROM_INSTANCE, select, false {to Receiver {RECEIVER}} other {}} {ATTACHMENT_TYPE, select, 0 {} 1 {(Attachment: File from {ATTACHMENT_FILE}} 2 {(Attachment: Mediaobject {ATTACHMENT_MEDIA, object})}}",
  "category": "target",
  "description": "Send Mail on the target address"
}